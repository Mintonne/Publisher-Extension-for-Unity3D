(function(e,t){"use strict";if(typeof define==="function"&&define.amd){define([],t)}else if(typeof module==="object"&&module.exports){module.exports=t(require("xmldom").DOMParser)}else{e.X2JS=t()}})(this,function(F){"use strict";return function e(d){var t="3.1.1";d=d||{};function r(){d.arrayAccessForm=d.arrayAccessForm||"none";d.emptyNodeForm=d.emptyNodeForm||"text";d.jsAttributeFilter=d.jsAttributeFilter;d.jsAttributeConverter=d.jsAttributeConverter;d.attributeConverters=d.attributeConverters||[];d.datetimeAccessFormPaths=d.datetimeAccessFormPaths||[];d.arrayAccessFormPaths=d.arrayAccessFormPaths||[];if(d.enableToStringFunc===undefined){d.enableToStringFunc=true}if(d.skipEmptyTextNodesForObj===undefined){d.skipEmptyTextNodesForObj=true}if(d.stripWhitespaces===undefined){d.stripWhitespaces=true}if(d.useDoubleQuotes===undefined){d.useDoubleQuotes=true}if(d.ignoreRoot===undefined){d.ignoreRoot=false}if(d.escapeMode===undefined){d.escapeMode=true}if(d.attributePrefix===undefined){d.attributePrefix="_"}if(d.selfClosingElements===undefined){d.selfClosingElements=true}if(d.keepCData===undefined){d.keepCData=false}if(d.jsDateUTC===undefined){d.jsDateUTC=false}}function n(){function r(e){var t=String(e);if(t.length===1){t="0"+t}return t}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function e(){return this.replace(/^\s+|^\n+|(\s|\n)+$/g,"")}}if(typeof Date.prototype.toISOString!=="function"){Date.prototype.toISOString=function e(){var t=1e3;return this.getUTCFullYear()+"-"+r(this.getUTCMonth()+1)+"-"+r(this.getUTCDate())+"T"+r(this.getUTCHours())+":"+r(this.getUTCMinutes())+":"+r(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/t).toFixed(3)).slice(2,5)+"Z"}}}r();n();var p={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};function g(e){var t=e.localName;if(t==null){t=e.baseName}if(t==null||t===""){t=e.nodeName}return t}function m(e){return e.prefix}function f(e){if(typeof e==="string")return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;");else return e}function x(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&amp;/g,"&")}function v(e,t,r){switch(d.arrayAccessForm){case"property":if(!(e[t]instanceof Array))e[t+"_asArray"]=[e[t]];else e[t+"_asArray"]=e[t];break}if(!(e[t]instanceof Array)&&d.arrayAccessFormPaths.length>0){var n=false;for(var i=0;i<d.arrayAccessFormPaths.length;i++){var a=d.arrayAccessFormPaths[i];if(typeof a==="string"){if(a===r){n=true;break}}else if(a instanceof RegExp){if(a.test(r)){n=true;break}}else if(typeof a==="function"){if(a(t,r)){n=true;break}}}if(n)e[t]=[e[t]]}}function s(e){var t=60;var r=e.split(/[-T:+Z]/g);var n=new Date(r[0],r[1]-1,r[2]);var i=r[5].split(".");n.setHours(r[3],r[4],i[0]);if(i.length>1)n.setMilliseconds(i[1]);if(r[6]&&r[7]){var a=r[6]*t+Number(r[7]);var s=/\d\d-\d\d:\d\d$/.test(e)?"-":"+";a=0+(s==="-"?-1*a:a);n.setMinutes(n.getMinutes()-a-n.getTimezoneOffset())}else if(e.indexOf("Z",e.length-1)!==-1){n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()))}return n}function h(e,t,r){if(d.datetimeAccessFormPaths.length>0){var n=r.split(".#")[0];for(var i=0;i<d.datetimeAccessFormPaths.length;i++){var a=d.datetimeAccessFormPaths[i];if(typeof a==="string"){if(a===n)return s(e)}else if(a instanceof RegExp){if(a.test(n))return s(e)}else if(typeof a==="function"){if(a(n))return s(e)}}}return e}function i(e){var t={};var r=e.childNodes;for(var n=0;n<r.length;n++){var i=r.item(n);if(i.nodeType===p.ELEMENT_NODE){var a=g(i);if(d.ignoreRoot)t=y(i,a);else t[a]=y(i,a)}}return t}function a(e,t){var r={};r.__cnt=0;var n=e.childNodes;for(var i=0;i<n.length;i++){var a=n.item(i);var s=g(a);if(a.nodeType===p.COMMENT_NODE)continue;r.__cnt++;if(r[s]==null){r[s]=y(a,t+"."+s);v(r,s,t+"."+s)}else{if(!(r[s]instanceof Array)){r[s]=[r[s]];v(r,s,t+"."+s)}r[s][r[s].length]=y(a,t+"."+s)}}for(var o=0;o<e.attributes.length;o++){var f=e.attributes.item(o);r.__cnt++;var u=f.value;for(var l=0;l<d.attributeConverters.length;l++){var c=d.attributeConverters[l];if(c.test.call(null,f.name,f.value))u=c.convert.call(null,f.name,f.value)}r[d.attributePrefix+f.name]=u}var _=m(e);if(_){r.__cnt++;r.__prefix=_}if(r["#text"]){r.__text=r["#text"];if(r.__text instanceof Array){r.__text=r.__text.join("\n")}if(d.escapeMode)r.__text=x(r.__text);if(d.stripWhitespaces)r.__text=r.__text.trim();delete r["#text"];if(d.arrayAccessForm==="property")delete r["#text_asArray"];r.__text=h(r.__text,"#text",t+".#text")}if(r.hasOwnProperty("#cdata-section")){r.__cdata=r["#cdata-section"];delete r["#cdata-section"];if(d.arrayAccessForm==="property")delete r["#cdata-section_asArray"]}if(r.__cnt===1&&r.__text){r=r.__text}else if(r.__cnt===0&&d.emptyNodeForm==="text"){r=""}else if(r.__cnt>1&&r.__text!==undefined&&d.skipEmptyTextNodesForObj){if(d.stripWhitespaces&&r.__text===""||r.__text.trim()===""){delete r.__text}}delete r.__cnt;if(!d.keepCData&&(!r.hasOwnProperty("__text")&&r.hasOwnProperty("__cdata")&&Object.keys(r).length===1)){return r.__cdata?r.__cdata:""}if(d.enableToStringFunc&&(r.__text||r.__cdata)){r.toString=function e(){return(this.__text?this.__text:"")+(this.__cdata?this.__cdata:"")}}return r}function y(e,t){if(e.nodeType===p.DOCUMENT_NODE){return i(e)}else if(e.nodeType===p.ELEMENT_NODE){return a(e,t)}else if(e.nodeType===p.TEXT_NODE||e.nodeType===p.CDATA_SECTION_NODE){return e.nodeValue}else{return null}}function o(e,t,r,n){var i="<"+(e&&e.__prefix?e.__prefix+":":"")+t;if(r){for(var a=0;a<r.length;a++){var s=r[a];var o=e[s];if(d.escapeMode)o=f(o);i+=" "+s.substr(d.attributePrefix.length)+"=";if(d.useDoubleQuotes)i+='"'+o+'"';else i+="'"+o+"'"}}if(!n)i+=">";else i+=" />";return i}function u(e,t){return"</"+(e&&e.__prefix?e.__prefix+":":"")+t+">"}function l(e,t){return e.indexOf(t,e.length-t.length)!==-1}function c(e,t){if(d.arrayAccessForm==="property"&&l(t.toString(),"_asArray")||t.toString().indexOf(d.attributePrefix)===0||t.toString().indexOf("__")===0||e[t]instanceof Function)return true;else return false}function _(e){var t=0;if(e instanceof Object){for(var r in e){if(c(e,r))continue;t++}}return t}function b(e){var t=[];if(e instanceof Object){for(var r in e){if(r.toString().indexOf("__")===-1&&r.toString().indexOf(d.attributePrefix)===0){t.push(r)}}}return t}function O(e){var t="";if(e.__cdata){t+="<![CDATA["+e.__cdata+"]]>"}if(e.__text||typeof e.__text==="number"||typeof e.__text==="boolean"){if(d.escapeMode)t+=f(e.__text);else t+=e.__text}return t}function A(e){var t="";if(e instanceof Object){t+=O(e)}else if(e!==null){if(d.escapeMode)t+=f(e);else t+=e}return t}function T(e,t,r){var n="";if(e.length===0){n+=o(e,t,r,true)}else{for(var i=0;i<e.length;i++){n+=D(e[i],t,b(e[i]))}}return n}function D(e,t,r){var n="";if(d.jsAttributeFilter&&d.jsAttributeFilter.call(null,t,e)){return n}if(d.jsAttributeConverter){e=d.jsAttributeConverter.call(null,t,e)}if((e===undefined||e===null||e==="")&&d.selfClosingElements){n+=o(e,t,r,true)}else if(typeof e==="object"){if(Object.prototype.toString.call(e)==="[object Array]"){n+=T(e,t,r)}else if(e instanceof Date){n+=o(e,t,r,false);n+=d.jsDateUTC?e.toUTCString():e.toISOString();n+=u(e,t)}else{var i=_(e);if(i>0||typeof e.__text==="number"||typeof e.__text==="boolean"||e.__text||e.__cdata){n+=o(e,t,r,false);n+=E(e);n+=u(e,t)}else if(d.selfClosingElements){n+=o(e,t,r,true)}else{n+=o(e,t,r,false);n+=u(e,t)}}}else{n+=o(e,t,r,false);n+=A(e);n+=u(e,t)}return n}function E(e){var t="";var r=_(e);if(r>0){for(var n in e){if(c(e,n))continue;var i=e[n];var a=b(i);t+=D(i,n,a)}}t+=A(e);return t}function C(e){if(e===undefined){return null}if(typeof e!=="string"){return null}var t=null;var r=null;if(F){t=new F;r=t.parseFromString(e,"text/xml")}else if(window&&window.DOMParser){t=new window.DOMParser;var n=null;var i=window.ActiveXObject||"ActiveXObject"in window;if(!i){try{n=t.parseFromString("INVALID","text/xml").childNodes[0].namespaceURI}catch(e){n=null}}try{r=t.parseFromString(e,"text/xml");if(n!==null&&r.getElementsByTagNameNS(n,"parsererror").length>0){r=null}}catch(e){r=null}}else{if(e.indexOf("<?")===0){e=e.substr(e.indexOf("?>")+2)}r=new ActiveXObject("Microsoft.XMLDOM");r.async="false";r.loadXML(e)}return r}this.asArray=function e(t){if(t===undefined||t===null){return[]}else if(t instanceof Array){return t}else{return[t]}};this.toXmlDateTime=function e(t){if(t instanceof Date){return t.toISOString()}else if(typeof t==="number"){return new Date(t).toISOString()}else{return null}};this.asDateTime=function e(t){if(typeof t==="string"){return s(t)}else{return t}};this.xml2dom=function e(t){return C(t)};this.dom2js=function e(t){return y(t,null)};this.js2dom=function e(t){var r=this.js2xml(t);return C(r)};this.xml2js=function e(t){var r=C(t);if(r!=null)return this.dom2js(r);else return null};this.js2xml=function e(t){return E(t)};this.getVersion=function e(){return t}}});